<!DOCTYPE html>
<html>

<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>voxel test</title>

<script type="text/javascript" src="lib/dat.gui.min.js"></script>
<script type="text/javascript" src="lib/stats.min.js"></script>
<script type="text/javascript" src="lib/perlin.js"></script><!-- https://github.com/josephg/noisejs/blob/master/perlin.js -->
<script type="text/javascript" src="lib/gl-matrix-min.js"></script>
<script type="text/javascript" src="utils/webgl_utils.js"></script>
<script type="text/javascript" src="data/wt_teapot-trimmed.obj.json"></script>

<script id="shader-simple-vs" type="x-shader/x-vertex">
	attribute vec3 aVertexPosition;
	uniform mat4 uMVMatrix;
	uniform mat4 uPMatrix;
	varying vec3 vPos;
	varying float fog;
	
	void main(void) {
		vec4 transformedCoord = uMVMatrix * vec4(aVertexPosition,1.0);	//todo use 4x3 mat?
		gl_Position = uPMatrix * transformedCoord;
		
		fog = -transformedCoord.z * 0.125;
		vPos=aVertexPosition;		
	}
</script>

<script id="shader-simple-fs" type="x-shader/x-fragment">
	precision mediump float;
	varying vec3 vPos;
	varying float fog;
	
	void main(void){
		//gl_FragColor=vec4(mod(0.999*vPos,1.0),1.0);	
		//gl_FragColor=vec4(mod(15.999*vPos,1.0),1.0);	
		//gl_FragColor=vec4(0.5+0.5*(cos(100.531*vPos)),1.0);	//100.531 ~ 16*(2*PI)
		
		//gl_FragColor=vec4(0.5+0.5*(cos(25.13*vPos)),1.0);	
		
		vec3 surfColor = 0.5+0.5*(cos(25.13*vPos));
		gl_FragColor=vec4(vec3(1.0,1.0,0.0)*fog+(1.0-fog)*surfColor,1.0);	
	}
	
</script>

<script id="shader-withnormals-vs" type="x-shader/x-vertex">
	attribute vec3 aVertexPosition;
	attribute vec3 aVertexNormal;
	uniform mat4 uMVMatrix;
	uniform mat4 uPMatrix;
	varying vec3 vPos;
	varying float fog;	//could combo with color
	varying vec3 vColor;
	
	void main(void) {
		vec4 transformedCoord = uMVMatrix * vec4(aVertexPosition,1.0);	//todo use 4x3 mat?
		gl_Position = uPMatrix * transformedCoord;
		
		//vColor = vec3(1.0)*max(0.0,dot(aVertexNormal,vec3(0.2,0.1,-0.8)));	//light direction (simple directional light)
		
		float lighting  = 0.5+0.5*dot(aVertexNormal,vec3(0.2,0.1,-0.8));
		
		vColor = pow(vec3(0.05,0.05,1.0)*lighting,vec3(0.455));	//light direction (simple directional light)
		
		fog = -transformedCoord.z * 0.125;
		vPos=aVertexPosition;		
	}
</script>

<script id="shader-color-fs" type="x-shader/x-fragment">
	precision mediump float;
	varying vec3 vPos;
	varying float fog;
	varying vec3 vColor;
	
	void main(void){	
		gl_FragColor=vec4(vec3(1.0,1.0,0.0)*fog+(1.0-fog)*vColor,1.0);	
	}
	
</script>


<script type="text/javascript" src="js/main.js"></script>

</head>
<body onload="init()">

<canvas id="mycanvas"></canvas>
<canvas id="glcanvas"></canvas>
<div id="debugtext"></div>

</body>
</html>
